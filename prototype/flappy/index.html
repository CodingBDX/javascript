<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <title>Document</title>
</head>
<body>
    
</body>
</html>
<script src="https://unpkg.com/kaboom/dist/kaboom.js"></script>
<script>
kaboom()

loadSprite("hero", "/sprites/Player/gif/bird2.gif");
loadSprite("background", "/sprites/Background/Background1.png");
loadSprite("pipe", "/sprites/Tileset/pipe.png");
loadSound("OtherworldlyFoe", "sounds/main.flac");
loadSound("woosh", "sounds/woosh.flac");

const music = play("OtherworldlyFoe", { loop: true, volume:0.1 });
isTouch = keyPress;
let HightScore = 0;


scene("menu", () => {
    
    add([
    sprite("background",  {width: width(), height: height()})
]);

add([
    sprite("hero"),
    pos(width() / 2, height() / 2 - 5), 
		origin("center"), 
        scale(5)
]);

add([
    text("Flappy BDX"),
    pos(width() / 2, height() / 2 - 100), 
		origin("center"),
 ])
 add([
    text("press space\nor\n tape screen", {size:50} ),
    pos(width() / 2, height() / 2 + 120),
    origin("center"), 
])
 keyPress("space", () => {
     go("game")
 })
	  onClick(() => {
        go("game")
	})
})


scene("game", () => {
const PIPE_GAP = 122;
let score = 0;
add([
    sprite("background",  {width: width(), height: height()})
]);

  // add a game object to screen
  const scoretxt = add([
    text(score, {size:50}),
    pos(24, 24),
    { value: 0 },
])

const  player = add([
    sprite("hero"),
    pos(80, 40),
    scale(2
    ),
    area(),
    body(),
])



function producePipes(){
    const offset = rand(-20,20);
add([ 
sprite("pipe",  {flipY: true} ),
pos(width() , height()/2 + offset + PIPE_GAP/2),
scale(2),
"pipe",
area(),
{passed: false}
])

add([ 
sprite("pipe"),
pos(width() , height()/2 + offset - PIPE_GAP/2),
origin("botleft"),
scale(2),
"pipe",
area()
])
}
loop(1.5, () =>{
    producePipes();
});
player.collides("pipe", () => {
go("gameover", score);
})

action("pipe", (pipe) => {
    pipe.move(-160, 0);
    
    if (pipe.passed === false && pipe.pos.x < player.pos.x) {

        pipe.passed = true;
        score += 1;
        scoretxt.text = score;
    }  
});

player.action(() => {
    if (player.pos.y > height() + 30 || player.pos.y < -30) {
        go("gameover", score)
    }
})
keyPress("space", () => {
    play("woosh", {  volume:0.5 }); 
    player.jump(400);
  
    })
    onClick(() => {
        play("woosh", {  volume:0.5 }); 
    player.jump(400);
	})
  
});

scene("gameover", (score) => {
    if (score > HightScore){
        HightScore = score;
    }
    add([
    sprite("background",  {width: width(), height: height()})
]);

add([
    text("gameover\n" + "score:" + score + "\n hight score:" + HightScore, {size:45}, area()),
    pos(width() / 2, height() / 2 - 100), 
		origin("center"),
 ])
 add([
    text("press space\nor\ntape screen", {size:32} ),
    pos(width() / 2, height() / 2 + 120),
    origin("center"), 
])
 keyPress("space", () => {
     go("game")
 })
})
go("menu");
</script>
